# House Management API

‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö Production ‡∏î‡πâ‡∏ß‡∏¢ Express.js, TypeScript ‡πÅ‡∏•‡∏∞ Prisma ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î

## üöÄ Recent Updates

- ‚úÖ **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô** - ‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö ‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡πâ‡∏≤‡∏ô
- ‚úÖ **‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ** - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô
- ‚úÖ **‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥** - ‡∏î‡πâ‡∏ß‡∏¢ Sharp (JPEG quality 85%, max 1920x1080)
- ‚úÖ **‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏¢‡∏Å Folder** - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏µ folder ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô
- ‚úÖ **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û** - ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡∏•‡∏ö‡∏£‡∏π‡∏õ

## üöÄ Features

### Authentication & User Management
- ‚úÖ Authentication & Authorization (JWT)
- ‚úÖ User Registration & Login
- ‚úÖ **Password Hashing (Argon2)** - ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏à‡∏≤‡∏Å bcrypt
- ‚úÖ Role-based Access Control (USER, MODERATOR, ADMIN)
- ‚úÖ Rate Limiting
- ‚úÖ Input Validation
- ‚úÖ Session Management

### House Management
- ‚úÖ **CRUD Operations** - ‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏≠‡πà‡∏≤‡∏ô ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö‡∏ö‡πâ‡∏≤‡∏ô
- ‚úÖ **Advanced Filtering** - ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡πâ‡∏≤‡∏ô
- ‚úÖ **House Types** - ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß ‡∏ó‡∏≤‡∏ß‡∏ô‡πå‡πÄ‡∏Æ‡∏≤‡∏™‡πå ‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î ‡∏≠‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏°‡∏ô‡∏ó‡πå
- ‚úÖ **Status Management** - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≤‡∏¢ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à ‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
- ‚úÖ **Owner Authorization** - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ

### Image Management
- ‚úÖ **Multi-Image Upload** - ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30 ‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô
- ‚úÖ **Image Compression** - ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ Sharp
- ‚úÖ **Folder Organization** - ‡πÅ‡∏¢‡∏Å folder ‡∏ï‡∏≤‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡πâ‡∏≤‡∏ô
- ‚úÖ **Main Image Setting** - ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏î‡πâ
- ‚úÖ **Image Reordering** - ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
- ‚úÖ **File Validation** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå
- ‚úÖ Profile Management
- ‚úÖ Database with Prisma ORM
- ‚úÖ TypeScript Support
- ‚úÖ **Function-based Architecture** - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Class-based
- ‚úÖ **Image Upload System** - Base64 ‡πÅ‡∏•‡∏∞ File upload ‡∏û‡∏£‡πâ‡∏≠‡∏° image processing
- ‚úÖ Security Best Practices

## üìã Prerequisites

- Node.js 18+
- PostgreSQL Database
- npm ‡∏´‡∏£‡∏∑‡∏≠ yarn

## üõ†Ô∏è Installation

1. **Clone ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies:**

```bash
npm install
```

2. **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables:**

```bash
cp .env.example .env
```

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `.env`:

```env
DATABASE_URL="postgresql://username:password@localhost:5432/myapp_db?schema=public"
JWT_SECRET="your-super-secret-jwt-key-change-this-in-production"
```

3. **Setup Database:**

```bash
# Generate Prisma Client
npm run db:generate

# Push schema to database
npm run db:push

# Seed database with test data
npm run db:seed
```

4. **Start Development Server:**

```bash
npm run dev
```

## üìö API Endpoints

### Authentication

| Method | Endpoint                    | Description     | Access    |
| ------ | --------------------------- | --------------- | --------- |
| POST   | `/v1/api/auth/register`        | ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å     | Public    |
| POST   | `/v1/api/auth/login`           | ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö     | Public    |
| POST   | `/v1/api/auth/logout`          | ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö      | Protected |
| POST   | `/v1/api/auth/refresh-token`   | ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä Token    | Protected |
| POST   | `/v1/api/auth/change-password` | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô | Protected |
| GET    | `/v1/api/auth/sessions`        | ‡∏î‡∏π Sessions     | Protected |
| DELETE | `/v1/api/auth/sessions/:id`    | ‡∏•‡∏ö Session      | Protected |

### User Management

| Method | Endpoint                          | Description          | Access          |
| ------ | --------------------------------- | -------------------- | --------------- |
| GET    | `/v1/api/users/profile`           | ‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á      | Protected       |
| PUT    | `/v1/api/users/profile`           | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå         | Protected       |
| GET    | `/v1/api/users`                   | ‡∏î‡∏π‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î      | Admin/Moderator |
| GET    | `/v1/api/users/:id`               | ‡∏î‡∏π‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏° ID       | Admin/Moderator |
| PATCH  | `/v1/api/users/:id/toggle-status` | ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ | Admin           |
| DELETE | `/v1/api/users/:id`               | ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ             | Admin           |

### Image Upload

| Method | Endpoint                    | Description        | Access    |
| ------ | --------------------------- | ------------------ | --------- |
| POST   | `/v1/api/upload/avatar`     | ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå   | Protected |
| DELETE | `/v1/api/upload/avatar`     | ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå       | Protected |
| POST   | `/v1/api/upload/image`      | ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ | Protected |

## üîê Authentication

‡πÉ‡∏ä‡πâ JWT Token ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Authentication:

```bash
Authorization: Bearer <your-jwt-token>
```

## üìù API Examples

### Register

```bash
POST /v1/api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "username": "username",
  "password": "Password123!@#",
  "firstName": "John",
  "lastName": "Doe"
}
```

### Login

```bash
POST /v1/api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "Password123!@#"
}
```

### Get Profile

```bash
GET /v1/api/users/profile
Authorization: Bearer <jwt-token>
```

### Update Profile

```bash
PUT /v1/api/users/profile
Authorization: Bearer <jwt-token>
Content-Type: application/json

{
  "firstName": "John",
  "lastName": "Smith",
  "bio": "Software Developer",
  "phone": "0812345678",
  "city": "Bangkok",
  "country": "Thailand"
}
```

### Upload Avatar (Base64)

```bash
POST /v1/api/upload/avatar
Authorization: Bearer <jwt-token>
Content-Type: application/json

{
  "avatar": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD..."
}
```

### Upload Avatar (File)

```bash
POST /v1/api/upload/avatar
Authorization: Bearer <jwt-token>
Content-Type: multipart/form-data

# Form data with file field named 'avatar'
```

## üîí Security Features

- **Password Hashing**: **Argon2** (‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏à‡∏≤‡∏Å bcrypt) - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á
- **JWT Tokens**: Secure token-based authentication
- **Rate Limiting**: API ‡πÅ‡∏•‡∏∞ Auth endpoints
- **Input Validation**: express-validator
- **Security Headers**: Helmet.js
- **CORS Protection**: Configurable CORS
- **SQL Injection Protection**: Prisma ORM
- **Function-based Architecture**: ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô

## üé≠ User Roles

- **USER**: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
- **MODERATOR**: ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• - ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- **ADMIN**: ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

## üß™ Test Accounts

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô `npm run db:seed`:

- **Admin**: `admin@example.com` / `Admin123!@#`
- **Moderator**: `moderator@example.com` / `Moderator123!@#`
- **Users**: `user1@example.com` ‡∏ñ‡∏∂‡∏á `user5@example.com` / `User[N]123!@#`

## üóÑÔ∏è Database Schema

```prisma
model User {
  id         String   @id @default(cuid())
  email      String   @unique
  username   String   @unique
  password   String
  firstName  String?
  lastName   String?
  avatar     String?
  role       Role     @default(USER)
  isActive   Boolean  @default(true)
  isVerified Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  sessions   Session[]
  profile    Profile?
}

model Profile {
  id          String    @id @default(cuid())
  userId      String    @unique
  bio         String?
  phone       String?
  dateOfBirth DateTime?
  address     String?
  city        String?
  country     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id])
}

enum Role {
  USER
  ADMIN
  MODERATOR
}
```

## üöÄ Production Deployment

1. **Environment Variables**:

```env
NODE_ENV=production
DATABASE_URL="your-production-database-url"
JWT_SECRET="your-super-secure-jwt-secret"
```

2. **Build**:

```bash
npm run build
npm start
```

3. **Database Migration**:

```bash
npm run db:migrate
```

## üìä Monitoring

- Health Check: `GET /health`
- API Documentation: `GET /v1/api`
- Swagger Documentation: `GET /v1/api-docs`
- Database Studio: `npm run db:studio`

## üìñ API Documentation

### Swagger/OpenAPI Documentation
- **Swagger UI**: `http://localhost:4000/v1/api-docs`
- **JSON Spec**: `http://localhost:4000/v1/api-docs.json`
- **Guide**: `docs/swagger-guide.md`

### Features
- ‚úÖ Interactive API testing
- ‚úÖ Complete endpoint documentation
- ‚úÖ Built-in JWT authentication
- ‚úÖ Request/response examples
- ‚úÖ Schema validation
- ‚úÖ Error response documentation
- ‚úÖ Image upload documentation

## üìÆ Postman Collection

Complete Postman collection ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô directory `postman/`:

- **Collection**: `postman/User-Management-API.postman_collection.json`
- **Environment**: `postman/User-Management-API.postman_environment.json`
- **Documentation**: `postman/README.md`
- **Test Scenarios**: `postman/test-scenarios.md`

### üöÄ Quick Import

1. ‡πÄ‡∏õ‡∏¥‡∏î Postman
2. Import ‡πÑ‡∏ü‡∏•‡πå JSON ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏à‡∏≤‡∏Å `postman/` directory
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "User Management API Environment"
4. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!

### ‚ú® Features

- ‚úÖ Auto JWT token management
- ‚úÖ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‚úÖ Test scenarios ‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢
- ‚úÖ Environment variables ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß
- ‚úÖ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Error handling

### üß™ Test Accounts

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô `npm run db:seed`:

- **Admin**: `admin@example.com` / `Admin123!@#`
- **Moderator**: `moderator@example.com` / `Moderator123!@#`
- **User**: `user1@example.com` / `User1123!@#`

## ü§ù Contributing

1. Fork the project
2. Create feature branch
3. Commit changes
4. Push to branch
5. Test with Postman collection
6. Open Pull Request
